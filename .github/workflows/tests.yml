name: Check Detective Tasks
on:
  push:
    branches:
      - code-review
      - team-coding
      - markdown
      - mermaid
      - llm

jobs:
  check_detective:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4


      - name: Run flake8 check
        run: |
          # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° flake8 ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
          pip install flake8
          
          # Ğ—Ğ°Ğ¿ÑƒÑĞº flake8 Ñ Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»
          flake8 . --count --max-complexity=10 --max-line-length=79 \
            --statistics --exclude=.git,__pycache__,venv
          
          # Ğ˜Ğ»Ğ¸ Ğ±Ğ¾Ğ»ĞµĞµ ÑÑ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:
          # flake8 . --ignore=E501,W503 --max-line-length=88

          
        
      - name: Calculate seeds
        id: seeds
        run: |
          # Seed 1: From username
          USERNAME_SEED=$(echo -n "${{ github.actor }}" | md5sum | head -c 1 | od -An -tx1 | tr -d ' ')
          USERNAME_SEED=$((16#$USERNAME_SEED % 5 + 1))
          
          # Seed 2: From day of month
          DAY_SEED=$(date +%d | sed 's/^0//')
          DAY_SEED=$((DAY_SEED % 5 + 1))
          
          # Seed 3: From hour
          HOUR_SEED=$(date +%H | sed 's/^0//')
          HOUR_SEED=$((HOUR_SEED % 5 + 1))
          
          # Seed 4: From combination
          COMBO_SEED=$(echo -n "${{ github.actor }}$(date +%d)$(date +%H)" | md5sum | tail -c 2 | od -An -td1 | tr -d ' ')
          COMBO_SEED=$((COMBO_SEED % 5 + 1))
          
          # Seed 5: Random
          PURE_SEED=$((RANDOM % 5 + 1))
          
          echo "USERNAME_SEED=$USERNAME_SEED" >> $GITHUB_OUTPUT
          echo "DAY_SEED=$DAY_SEED" >> $GITHUB_OUTPUT
          echo "HOUR_SEED=$HOUR_SEED" >> $GITHUB_OUTPUT
          echo "COMBO_SEED=$COMBO_SEED" >> $GITHUB_OUTPUT
          echo "PURE_SEED=$PURE_SEED" >> $GITHUB_OUTPUT
      
      - name: Map seeds to task values
        id: tasks
        run: |
          # Task 1: Branch (uses USERNAME_SEED)
          case ${{ steps.seeds.outputs.USERNAME_SEED }} in
            1) BRANCH="code-review" ;;
            2) BRANCH="team-coding" ;;
            3) BRANCH="markdown" ;;
            4) BRANCH="mermaid" ;;
            5) BRANCH="llm" ;;
          esac
          echo "BRANCH=$BRANCH" >> $GITHUB_OUTPUT
          
          # Task 2: File (uses DAY_SEED)
          case ${{ steps.seeds.outputs.DAY_SEED }} in
            1) FILE="qwen-advice.md" ;;
            2) FILE="chatgpt-guide.txt" ;;
            3) FILE="perplexity-tips.md" ;;
            4) FILE="gigachat-notes.csv" ;;
            5) FILE="copilot-wisdom.md" ;;
          esac
          echo "FILE=$FILE" >> $GITHUB_OUTPUT
          
          # Task 3: Phrase (uses HOUR_SEED)
          case ${{ steps.seeds.outputs.HOUR_SEED }} in
            1) PHRASE="Ğ¡ Ğ½Ğ¾Ğ²Ñ‹Ğ¼ Ğ³Ğ¾Ğ´Ğ¾Ğ¼! ĞŸÑƒÑÑ‚ÑŒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ±Ğ»ĞµÑĞ½ĞµÑ‚ ĞºÑ€Ğ°ÑĞ¾Ñ‚Ğ¾Ğ¹!" ;;
            2) PHRASE="Ğ£ÑĞ¿ĞµÑ…Ğ¾Ğ² Ğ² Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸! Ğ’Ğ°Ğ¹Ğ±-ĞºĞ¾Ğ´Ğ¸Ğ½Ğ³ - ÑÑ‚Ğ¾ Ñ‚Ğ²Ğ¾Ğ¹ Ğ¿ÑƒÑ‚ÑŒ!" ;;
            3) PHRASE="ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ³Ğ¾Ğ´ - Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸! Ğ’Ğ¿ĞµÑ€ĞµĞ´ Ğº Ğ·Ğ½Ğ°Ğ½Ğ¸ÑĞ¼!" ;;
            4) PHRASE="ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑÑ Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾Ğ¼ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°! Ğ Ğ°Ğ·Ğ²Ğ¸Ğ²Ğ°Ğ¹ÑÑ ÑĞ¼ĞµĞ»Ğ¾!" ;;
            5) PHRASE="ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ³Ğ¾Ğ´ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ°ĞµĞ¼ Ñ ÑĞ½Ñ‚ÑƒĞ·Ğ¸Ğ°Ğ·Ğ¼Ğ¾Ğ¼! Ğ£Ñ‡Ğ¸ÑÑŒ, ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ¹, Ğ¿Ñ€ĞµÑƒÑĞ¿ĞµĞ²Ğ°Ğ¹!" ;;
          esac
          echo "PHRASE=$PHRASE" >> $GITHUB_OUTPUT
          
          # Task 4: Folder (uses COMBO_SEED)
          case ${{ steps.seeds.outputs.COMBO_SEED }} in
            1) FOLDER="andrej_karpathy" ;;
            2) FOLDER="yan_lecun" ;;
            3) FOLDER="sam_altman" ;;
            4) FOLDER="ian_goodfellow" ;;
            5) FOLDER="geoffrey_everest_hinton" ;;
          esac
          echo "FOLDER=$FOLDER" >> $GITHUB_OUTPUT
          
          # Task 5: Artifact (uses PURE_SEED)
          case ${{ steps.seeds.outputs.PURE_SEED }} in
            1) ARTIFACT="qwen.png" ;;
            2) ARTIFACT="claude.pdf" ;;
            3) ARTIFACT="chatgpt.jpg" ;;
            4) ARTIFACT="cursor.pptx" ;;
            5) ARTIFACT="lovable.png" ;;
          esac
          echo "ARTIFACT=$ARTIFACT" >> $GITHUB_OUTPUT
      
      - name: "âœ… Task 1: Check branch name"
        run: |
          CURRENT_BRANCH=${{ github.ref_name }}
          EXPECTED_BRANCH=${{ steps.tasks.outputs.BRANCH }}
          
          if [ "$CURRENT_BRANCH" = "$EXPECTED_BRANCH" ]; then
            echo "âœ… Ğ’ĞµÑ‚ĞºĞ° Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ"
          else
            echo "âŒ Ğ’ĞµÑ‚ĞºĞ° Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ°Ñ (ĞºĞ°Ğº Ğ¶Ğµ Ñ‚ĞµĞ±Ñ Ğ·Ğ¾Ğ²ÑƒÑ‚)"
            exit 1
          fi
      
      - name: "âœ… Task 2: Check file exists and format"
        run: |
          FILE=${{ steps.tasks.outputs.FILE }}
          
          if [ -f "$FILE" ]; then
            echo "âœ… Ğ¤Ğ°Ğ¹Ğ» Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          else
            echo "âŒ Ğ¤Ğ°Ğ¹Ğ» Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ (ĞºĞ°ĞºĞ¾Ğ¹ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ´ĞµĞ½ÑŒ)"
            exit 1
          fi
      
      - name: "âœ… Task 3: Check positive phrase in file"
        run: |
          FILE=${{ steps.tasks.outputs.FILE }}
          PHRASE="${{ steps.tasks.outputs.PHRASE }}"
          
          if grep -q "$PHRASE" "$FILE"; then
            echo "âœ… ĞĞ°Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ"
          else
            echo "âŒ ĞĞ°Ğ´Ğ¿Ğ¸ÑÑŒ Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ°Ñ (ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ‡Ğ°Ñ)"
            exit 1
          fi
      
      - name: "âœ… Task 4: Check folder with person name"
        run: |
          FOLDER=${{ steps.tasks.outputs.FOLDER }}
          
          if [ -d "$FOLDER" ]; then
            echo "âœ… ĞŸĞ°Ğ¿ĞºĞ° Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°"
          else
            echo "âŒ ĞŸĞ°Ğ¿ĞºĞ° Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ°Ñ (Ñ€Ğ°Ğ·Ğ½Ğ¾Ğµ)"
            exit 1
          fi
      
      - name: "âœ… Task 5: Check artifact file in folder"
        run: |
          FOLDER=${{ steps.tasks.outputs.FOLDER }}
          ARTIFACT=${{ steps.tasks.outputs.ARTIFACT }}
          FULL_PATH="$FOLDER/$ARTIFACT"
          
          if [ -f "$FULL_PATH" ]; then
            echo "âœ… ĞÑ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          else
            echo "âŒ ĞÑ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚ Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ (Ñ‚ÑƒÑ‚ Ñ‚ÑƒĞ¿Ğ° Ñ€Ğ°Ğ½Ğ´Ğ¾Ğ¼)"
            exit 1
          fi
      
      - name: ğŸ‰ ALL TASKS COMPLETED!
        if: success()
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘ ğŸ‰ Ğ’Ğ¡Ğ• Ğ—ĞĞ”ĞĞĞ˜Ğ¯ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ«!                         â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: âŒ TASKS FAILED
        if: failure()
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘       âŒ Ğ—ĞĞ”ĞĞĞ˜Ğ• ĞĞ• ĞŸĞ ĞĞ™Ğ”Ğ•ĞĞ âŒ        â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"